@model ToonSpace.Models.ViewModels.IndexFeedViewModel
@using ToonSpace.Services
@using Microsoft.AspNetCore.Identity
@using ToonSpace.Enums
@using (Html.BeginForm())
@inject IImageService _imageService
@inject UserManager<ToonUser> userManager
@{
    ViewData["Title"] = "Timeline";
}

<div class="container-fluid gedf-wrapper">
    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <div class="text-center">
                        <img src="@_imageService.DecodeImage(Model.User.ImageData, Model.User.ContentType)" class="img-fluid" alt="Profile Pic">
                    </div>
                    <a class="h5" asp-action="ArtistPage" asp-controller="Home" asp-route-Id="@Model.User.Id">@Model.User.FullName</a>
                    <hr />
                    <div class="h7 text-muted">@Model.User.Nickname</div>
                    <div class="h7">
                        @Model.User.Bio
                    </div>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <div class="h6 text-muted">Followers</div>
                        <div class="h5">@Model.User.Followers.Count</div>
                    </li>
                    <li class="list-group-item">
                        <div class="h6 text-muted">Following</div>
                        <div class="h5">@Model.User.Following.Count</div>
                    </li>
                    <li class="list-group-item">
                        <a class="btn btn-primary text-white" asp-area="Identity" asp-page="/Account/Manage/Index">Edit Profile</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-md-6 gedf-main">

            <!--- \\\\\\\Create Post-->
            <div class="card gedf-card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="images-tab" data-toggle="tab" role="tab" aria-controls="images" aria-selected="true" href="#images">Share a Toon</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="posts-tab" data-toggle="tab" href="#posts" role="tab" aria-controls="posts" aria-selected="false">
                                Create a Collection
                            </a>
                        </li>
                    </ul>
                </div>
                <form asp-action="Create" asp-controller="Uploads" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade" id="posts" role="tabpanel" aria-labelledby="posts-tab">
  
                            </div>
                            <div class="tab-pane fade show active" id="images" role="tabpanel" aria-labelledby="images-tab">
                                <div class="form-group">
                                    <div class="form-group">
                                        <label asp-for="@Model.MyUpload.ImageFile" class="control-label"></label>
                                        <input asp-for="@Model.MyUpload.ImageFile" type="file" class="form-control" />
                                        <span asp-validation-for="@Model.MyUpload.ImageFile" class="text-danger"></span>
                                    </div>
                                    <div>
                                        <div class="form-group">
                                            <label asp-for="@Model.MyUpload.Title" class="control-label"></label>
                                            <input asp-for="@Model.MyUpload.Title" class="form-control" placeholder="What's your Toon's title?" />
                                            <span asp-validation-for="@Model.MyUpload.Title" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label asp-for="@Model.MyUpload.Description" class="control-label"></label>
                                        <input asp-for="@Model.MyUpload.Description" class="form-control" />
                                        <span asp-validation-for="@Model.MyUpload.Description" class="text-danger"></span>
                                    </div>
                                    <div class="btn-toolbar justify-content-between">
                                        <div class="btn-group">
                                            @*<input type="hidden" name="returnUrl" value="@ViewBag.returnUrl" />*@
                                            <button type="submit" class="btn btn-primary">Share</button>
                                        </div>

                                        <div class="btn-group">
                                            <button id="btnGroupDrop1" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                <i class="fa fa-globe"></i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                                                <a class="dropdown-item" href="#"><i class="fa fa-globe"></i> Public</a>
                                                <a class="dropdown-item" href="#"><i class="fa fa-users"></i> Friends</a>
                                                <a class="dropdown-item" href="#"><i class="fa fa-user"></i> Just me</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="py-4"></div>
                            </div>
                        </div>

                    </div>
                </form>
            </div>
            <!-- Create Post /////-->
            <!--- \\\\\\\TimeLine Posts-->
            @foreach (Upload upload in Model.Uploads)
            {
                <!--- \\\\\\\Upload-->
                <div class="card gedf-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="mr-2">
                                    <img class="rounded-circle" width="45" src="@_imageService.DecodeImage(upload.Artist.ImageData, upload.Artist.ContentType)" alt="Artist Profile Pic">
                                </div>
                                <div class="ml-2">
                                    <a class="h5 m-0">@upload.Artist.FullName</a>
                                    <div class="h7 text-muted">@upload.Artist.Nickname</div>
                                </div>
                            </div>
                            <div>
                                <div class="dropdown">
                                    <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-h"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                                        <div class="h6 dropdown-header">Configuration</div>
                                        <a class="dropdown-item" href="#">Save</a>
                                        <a class="dropdown-item" href="#">Hide</a>
                                        <a class="dropdown-item" href="#">Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-body">

                        <a asp-controller="Uploads" asp-action="Details" asp-route-id="@upload.Id" class="card-link">
                            <h5 class="card-title">@upload.Title</h5>
                            <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o"></i>@upload.Created.ToShortTimeString()</div>
                        </a>

                        <p class="card-text">
                            @upload.Description
                        </p>
                        <img src="@_imageService.DecodeImage(upload.Image, upload.ContentType)" class="img-fluid" />
                    </div>
                    <div class="card-footer">
                        <a asp-controller="Uploads" asp-action="LikeUnlike" asp-route-Id="@upload.Id" class="card-link"><i class="fa fa-gittip"></i> Like @if (upload.Likes.Any())
                        {<p>(@upload.Likes.Count)</p>}</a>
                        <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                        <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
                        @if (userManager.GetUserId(User) == upload.Artist.Id)
                        {
                            <a asp-action="Delete" asp-controller="Uploads" asp-route-id="@upload.Id" method="post" class="card-link"><i class="fas fa-minus-circle"></i> Delete</a>
                        }
                        <form asp-action="Create" asp-controller="Comments" method="post">
                            <input type="hidden" name="MyUploadId" />
                            <textarea class="form-control" name="Body" rows="3" placeholder="Add a comment..."></textarea>
                            <button class="btn btn-dark btn-block btn-small Oz" type="submit">Add Comment</button>

                        </form>
                    </div>
                </div>
                <!-- Upload /////-->
            }


        </div>
        <div class="col-md-3">
            <div class="card gedf-card">
                <div class="card-body">
                    <h5 class="card-title">Trending Posts</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Hot right now</h6>
                    <p class="card-text">
                        I dunno what should go here.
                    </p>
                    <ul>
                        @foreach (Upload upload in Model.TrendingUploads)
                        {
                        <li>
                            <a asp-controller="Uploads" asp-action="Details" asp-route-id="@upload.Id" class="card-link">@upload.Title</a>
                        </li>
                        }
                    </ul>
                </div>
            </div>
            <div class="card gedf-card">
                <div class="card-body">
                    <h5 class="card-title">Card title</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                    <p class="card-text">
                        Some quick example text to build on the card title and make up the bulk of the
                        card's content.
                    </p>
                    <a href="#" class="card-link">Card link</a>
                    <a href="#" class="card-link">Another link</a>
                </div>
            </div>
        </div>
    </div>
</div>
